sap.ui.define(["./util/BaseController","sap/ui/core/routing/History","sap/ui/core/Fragment","sap/ui/util/Storage","sap/ui/Device","./util/SWHelper"],function(t,e,o,n,i,s){"use strict";return t.extend("com.perezjquim.iglivemode.pwa.controller.App",{onInit:function(t){const e=new s(this);e.init();this._reloadConfig();this._checkLogin()},onHomeButtonPress:function(t){const e=t.getSource();const o=e.getParent();const n=o.getSideContent();const i=n.getItem();const s=i.getItems();const c=s.find(function(t){const e=t.getKey();return e=="Home"});i.fireItemSelect({item:c})},onMenuButtonPress:function(t){const e=t.getSource();const o=e.getParent();const n=o.getSideExpanded();o.setSideExpanded(!n)},onNavigationItemSelect:function(t){const e=t.getParameter("item");const o=e.getKey();this.navTo(o);const n=i.system.phone;if(n){const e=t.getSource();const o=e.getParent();o.setSideExpanded(false)}},onNavButtonPress:function(t){this.navBack()},_reloadConfig:function(){const t=this.getStorage();const e=t.getItem("config");if(e){const t=JSON.parse(e);const o=this.getModel("config");o.setData(t)}},_checkLogin:function(){const t=this.getModel("config");const e=localStorage.getItem("is_logged_in")=="true";if(!e){this._askForLogin()}},_askForLogin:function(){if(!this._oLoginPromptDialog){this.setBusy(true);o.load({name:"com.perezjquim.iglivemode.pwa.view.fragment.LoginPrompt",controller:this}).then(function(t){this.setBusy(false);const e=this.getView();e.addDependent(t);t.open();this._oLoginPromptDialog=t}.bind(this))}else{this._oLoginPromptDialog.open()}},onBeforeOpenLoginPrompt:function(t){this.clearModel("login_prompt")},onAfterCloseLoginPrompt:function(t){this.clearModel("login_prompt")},onConfirmLogin:function(t){this.setBusy(true);const e=this.getModel("login_prompt");const o=e.getData();const n={auth:o};const i=JSON.stringify(n);if(o&&i){fetch(`${this.API_BASE_URL}/login`,{method:"POST",body:i}).then(t=>{if(t.ok){localStorage.setItem("is_logged_in","true");const t=this.getText("action_success");this.toast(t);this._oLoginPromptDialog.close()}else{const t=this.getText("action_error");this.toast(t)}}).catch(()=>{const t=this.getText("action_error");this.toast(t)}).finally(()=>{this.setBusy(false)})}else{this.setBusy(false);const t=this.getText("incomplete_data");this.toast(t)}},dummyEscapeHandler:function(t){t.resolve()}})});