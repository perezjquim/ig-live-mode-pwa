sap.ui.define(["./util/BaseController","sap/m/MessageBox","sap/ui/core/Fragment"],function(e,t,o){"use strict";return e.extend("com.perezjquim.iglivemode.pwa.controller.Config",{_oFetchPromises:[],onInit:function(){const e=this.getModel("config");e.attachPropertyChange(this.onConfigChange.bind(this))},onConfigChange:function(){this.setBusy(true);const e=this.getModel("config");const t=e.getData();const o=JSON.stringify(t);const n=this.getStorage();n.setItem("config",o);this.setBusy(false)},onAddEntry:function(e){const t=e.getSource();this._oNewUserSource=t;if(!this._oNewUserPopover){this.setBusy(true);const e=this.getView();o.load({name:"com.perezjquim.iglivemode.pwa.view.fragment.NewUserPopover",controller:this}).then(function(o){this.setBusy(false);e.addDependent(o);o.openBy(t);this._oNewUserPopover=o}.bind(this))}else{if(this._oNewUserPopover.isOpen()){this._oNewUserPopover.close()}else{this._oNewUserPopover.openBy(t)}}},onConfirmNewUser:function(e){const t=this.getModel("new_user_prompt");const o=t.getProperty("/user_name");this._addEntry(this._oNewUserSource,o);this._closePopover(e)},onCancelNewUser:function(e){this._closePopover(e)},_closePopover:function(e){const t=e.getSource();const o=t.getParent();const n=o.getParent();n.close()},onBeforeOpenNewUserPopover:function(e){this.clearModel("new_user_prompt")},onAfterCloseNewUserPopover:function(e){this.clearModel("new_user_prompt")},_addEntry:function(e,t){const o=e.getParent();const n=o.getParent();const s=n.getBinding("items");const i=s.getModel();const r=s.getPath();const c=i.getProperty(r);const a=c.concat([{user_name:t}]);i.setProperty(r,a)},onRemoveEntry:function(e){const o=e.getSource();const n=this.getText("confirm_remove_user");t.confirm(n,{actions:[t.Action.OK,t.Action.CANCEL],emphasizedAction:t.Action.OK,onClose:function(e){if(e==t.Action.OK){this._removeEntry(o);const e=this.getText("user_removed");this.toast(e)}}.bind(this)})},_removeEntry:function(e){const t=e.getParent();const o=t.getParent();const n=o.getParent();const s=n.getItems();const i=s.findIndex(function(e){return e==o});const r=n.getBinding("items");const c=r.getModel();const a=r.getPath();const f=c.getProperty(a);const h=f;h.splice(i,1);c.setProperty(a,h);this.onConfigChange()},fetchAvatar:async function(e){if(e){const t=await this._getUserInfo(e);if(t){const e="profile_pic_content";const o=t[e];return o}}},fetchFullName:async function(e){if(e){const t=await this._getUserInfo(e);if(t){const e="full_name";const o=t[e];return o}}},_getUserInfo:async function(e){const t=this.getModel("ig_user_info");const o=`/${e}`;var n=t.getProperty(o);if(n){return n}else{n=await this._fetchUserInfo(e);t.setProperty(o,n);return n}},_fetchUserInfo:async function(e){if(!this._oFetchPromises[e]){this._oFetchPromises[e]=fetch(`${this.API_BASE_URL}/get-user-info/${e}`,{method:"GET"})}const t=this._oFetchPromises[e];const o=await t;if(o.ok){const e=await o.json();return e}else{return{}}}})});