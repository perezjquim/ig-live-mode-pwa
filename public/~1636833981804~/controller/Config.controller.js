sap.ui.define(["./util/BaseController","sap/m/MessageBox","sap/ui/core/Fragment"],function(e,t,o){"use strict";return e.extend("com.perezjquim.iglivemode.pwa.controller.Config",{onInit:function(){const e=this.getModel("config");e.attachPropertyChange(this.onConfigChange.bind(this))},onConfigChange:function(){this.setBusy(true);const e=this.getModel("config");const t=e.getData();const o=JSON.stringify(t);const n=this.getStorage();n.setItem("config",o);this.setBusy(false)},onAddEntry:function(e){const t=e.getSource();this._oNewUserSource=t;if(!this._oNewUserPopover){this.setBusy(true);const e=this.getView();o.load({name:"com.perezjquim.iglivemode.pwa.view.fragment.NewUserPopover",controller:this}).then(function(o){this.setBusy(false);e.addDependent(o);o.openBy(t);this._oNewUserPopover=o}.bind(this))}else{if(this._oNewUserPopover.isOpen()){this._oNewUserPopover.close()}else{this._oNewUserPopover.openBy(t)}}},onConfirmNewUser:function(e){const t=this.getModel("new_user_prompt");const o=t.getProperty("/user_name");this._addEntry(this._oNewUserSource,o);this._closePopover(e)},onCancelNewUser:function(e){this._closePopover(e)},_closePopover:function(e){const t=e.getSource();const o=t.getParent();const n=o.getParent();n.close()},onBeforeOpenNewUserPopover:function(e){this.clearModel("new_user_prompt")},onAfterCloseNewUserPopover:function(e){this.clearModel("new_user_prompt")},_addEntry:function(e,t){const o=e.getParent();const n=o.getParent();const s=n.getBinding("items");const i=s.getModel();const r=s.getPath();const c=i.getProperty(r);const g=c.concat([{user_name:t}]);i.setProperty(r,g)},onRemoveEntry:function(e){const o=e.getSource();const n=this.getText("confirm_remove_user");t.confirm(n,{actions:[t.Action.OK,t.Action.CANCEL],emphasizedAction:t.Action.OK,onClose:function(e){if(e==t.Action.OK){this._removeEntry(o);const e=this.getText("user_removed");this.toast(e)}}.bind(this)})},_removeEntry:function(e){const t=e.getParent();const o=t.getParent();const n=o.getParent();const s=n.getItems();const i=s.findIndex(function(e){return e==o});const r=n.getBinding("items");const c=r.getModel();const g=r.getPath();const a=c.getProperty(g);const u=a;u.splice(i,1);c.setProperty(g,u);this.onConfigChange()}})});