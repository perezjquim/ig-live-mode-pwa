sap.ui.define(["./util/BaseController","sap/ui/core/routing/History","sap/ui/core/Fragment","sap/ui/util/Storage","sap/ui/Device","./util/SWHelper"],function(t,e,o,n,s,i){"use strict";return t.extend("com.perezjquim.iglivemode.pwa.controller.App",{onInit:function(t){const e=new i(this);e.init();this._reloadConfig();this._checkLogin()},onHomeButtonPress:function(t){const e=t.getSource();const o=e.getParent();const n=o.getSideContent();const s=n.getItem();const i=s.getItems();const a=i.find(function(t){const e=t.getKey();return e=="Home"});s.fireItemSelect({item:a})},onMenuButtonPress:function(t){const e=t.getSource();const o=e.getParent();const n=o.getSideExpanded();o.setSideExpanded(!n)},onNavigationItemSelect:function(t){const e=t.getParameter("item");const o=e.getKey();this.navTo(o);const n=s.system.phone;if(n){const e=t.getSource();const o=e.getParent();o.setSideExpanded(false)}},onNavButtonPress:function(t){this.navBack()},_reloadConfig:function(){const t=this.getStorage();var e={};const o=t.getItem("config");if(o){e=JSON.parse(o)}const n=t.getItem("authenticated_user_name");e["authenticated_user_name"]=n;const s=this.getModel("config");s.setData(e)},_checkLogin:function(){const t=this.getModel("config");const e=Boolean(localStorage.getItem("authenticated_user_name"));if(!e){this._askForLogin()}},_askForLogin:function(){if(!this._oLoginPromptDialog){this.setBusy(true);o.load({name:"com.perezjquim.iglivemode.pwa.view.fragment.LoginPrompt",controller:this}).then(function(t){this.setBusy(false);const e=this.getView();e.addDependent(t);t.open();this._oLoginPromptDialog=t}.bind(this))}else{this._oLoginPromptDialog.open()}},onBeforeOpenLoginPrompt:function(t){this.clearModel("login_prompt")},onAfterCloseLoginPrompt:function(t){this.clearModel("login_prompt")},onConfirmLogin:async function(t){this.setBusy(true);const e=this.getModel("login_prompt");const o=e.getData();const n=o["user"];const s=o["pw"];const i="Basic "+btoa(n+":"+s);if(o&&i){fetch(`${this.API_BASE_URL}/login`,{method:"POST",headers:{Authorization:i}}).then(async t=>{if(t.ok){const e=await t.json();const o=JSON.stringify(e);localStorage.setItem("ig_settings",o);localStorage.setItem("authenticated_user_name",n);this._reloadConfig();const s=this.getText("action_success");this.toast(s);this._oLoginPromptDialog.close()}else{const t=this.getText("action_error");this.toast(t)}}).catch(()=>{const t=this.getText("action_error");this.toast(t)}).finally(()=>{this.setBusy(false)})}else{this.setBusy(false);const t=this.getText("incomplete_data");this.toast(t)}},dummyEscapeHandler:function(t){t.reject()},onAvatarPress:function(t){const e=t.getSource();if(!this._oUserDetailsPopover){this.setBusy(true);o.load({name:"com.perezjquim.iglivemode.pwa.view.fragment.UserDetailsPopover",controller:this}).then(function(t){this.setBusy(false);const o=this.getView();o.addDependent(t);t.openBy(e);this._oUserDetailsPopover=t}.bind(this))}else{if(this._oUserDetailsPopover.isOpen()){this._oUserDetailsPopover.close()}else{this._oUserDetailsPopover.openBy(e)}}},onLogoff:function(t){this.setBusy(true);localStorage.setItem("authenticated_user_name","");location.reload()}})});